# MangoAgent 新功能说明

## 🆕 新增功能

### 1. 端口设置功能 ⚙️

现在您可以在Web界面中灵活配置API端口和代理设置，无需修改代码。

#### 功能特点：
- **API端口配置**: 可以修改后端API服务端口（默认8001，不是VPN端口）
- **代理设置**: 支持启用/禁用HTTP代理，配置代理主机和端口（VPN端口）
- **实时生效**: 设置保存后立即生效，无需重启服务
- **用户友好**: 直观的Web界面，支持表单验证

#### 使用方法：
1. 在Web界面中找到"⚙️ 端口设置 (Port Settings)"展开面板
2. 配置API端口（1024-65535范围）
3. 选择是否启用代理
4. 如果启用代理，配置代理主机和端口
5. 点击"保存端口设置"按钮

#### 配置示例：
```yaml
API端口: 8001  # 后端服务端口
启用代理: true
代理主机: 127.0.0.1
代理端口: 7890  # VPN端口
```

### 2. 多Prompt选择功能 📋

现在支持同时选择多个Prompt文件进行批量视频生成，大大提高工作效率。

#### 功能特点：
- **灵活选择**: 支持单个Prompt或批量选择多个Prompt
- **预览功能**: 可以预览所有选中Prompt的内容
- **批量生成**: 一次性提交多个任务到Flow或Veo API
- **状态反馈**: 实时显示每个任务的执行状态
- **错误处理**: 单个任务失败不影响其他任务

#### 使用方法：

##### 单个Prompt模式：
1. 选择"单个Prompt"模式
2. 从下拉列表中选择一个Prompt文件
3. 可以编辑Prompt内容（可选）
4. 选择生成方式（Flow或Veo API）
5. 点击生成按钮

##### 多个Prompt模式：
1. 选择"多个Prompt"模式
2. 勾选要生成的Prompt文件
3. 系统会显示所有选中文件的预览
4. 选择生成方式（Flow或Veo API）
5. 点击生成按钮开始批量处理

#### 支持的生成方式：

##### 浏览器自动化 (Flow)：
- 自动操作本地Chrome浏览器
- 支持自定义Chrome调试端口
- 支持自定义Flow页面URL
- 批量提交到Flow队列

##### Veo 3 API：
- 直接调用Veo 3 API
- 支持字符串和JSON格式的Prompt内容
- 批量提交到Veo API

## 🔧 技术实现

### 端口设置实现：
- 使用Streamlit session_state存储配置
- 动态生成API基础URL
- 智能代理设置处理
- 实时配置更新

### 多Prompt选择实现：
- 前端：Streamlit多选组件
- 后端：支持批量API调用
- 错误处理：单个任务失败不影响整体
- 状态反馈：实时显示处理进度

## 🚀 使用建议

1. **端口设置**：
   - 如果使用VPN，建议启用代理设置
   - 确保API端口不被其他服务占用
   - 代理端口通常是7890（Clash）或1080（其他代理软件）
   - API端口是后端服务端口，代理端口是VPN端口

2. **多Prompt生成**：
   - 建议先用单个Prompt测试配置
   - 批量生成时注意浏览器资源占用
   - Flow模式适合本地生成，Veo API适合云端生成

3. **性能优化**：
   - 批量生成时建议分批处理（每次5-10个）
   - 监控系统资源使用情况
   - 及时清理失败的生成任务

## 🐛 故障排除

### 端口设置问题：
- 检查端口是否被占用：`netstat -an | findstr :8001`
- 确认代理软件是否正常运行
- 验证代理端口是否正确

### 多Prompt生成问题：
- 确保所有选中的Prompt文件存在且格式正确
- 检查Chrome浏览器是否正常运行
- 验证Veo API密钥是否有效

## 📝 更新日志

- **v3.2.1**: 添加端口设置功能
- **v3.2.1**: 添加多Prompt选择功能
- **v3.2.1**: 优化Veo API字符串支持
- **v3.2.1**: 改进错误处理和用户反馈
